# 要件書

## はじめに
Bunken（文献）は、日本語文章の校正を支援するローカル完結型Webアプリケーションです。ルールベース検出とLLM提案のハイブリッドアプローチで、誤字・表記ゆれ・冗長・敬語誤用・スタイル逸脱を自動検出し、理由つきの修正案をワンクリックで適用できる革新的なツールです。

## 要件

### 要件1: テキスト入力・解析機能
**ユーザーストーリー:** ユーザーとして、テキストを入力して校正解析を実行したいので、文章の品質向上ができる

#### 受け入れ基準
1. WHEN ユーザーがテキストエリアにテキストを入力 THEN システムは最大20,000字まで受け付ける
2. WHEN ユーザーが「校正」ボタンをクリック THEN システムは即座に解析を開始する
3. WHEN ユーザーが入力を停止して500ms経過 AND 自動解析がON THEN システムは自動的に解析を開始する
4. WHEN テキストが20,000字を超過 THEN システムは警告メッセージを表示し段落ごとの解析を提案する
5. WHERE 2000字のテキスト解析 THE システムは5秒以内（P95）で結果を返す

### 要件2: ルールベース検出機能
**ユーザーストーリー:** ユーザーとして、確実で安定したルールベース検出を利用したいので、一般的な文章問題を自動修正できる

#### 受け入れ基準
1. WHEN テキストに表記ゆれがある THEN システムは「コンピュータ/コンピューター」「全角/半角」「ひら/カナ」の統一問題を検出する
2. WHEN テキストに文法誤用がある THEN システムはら抜き言葉・二重否定を検出する
3. WHEN テキストに冗長表現がある THEN システムは「〜することができる→〜できる」等の簡潔化を提案する
4. WHEN テキストに敬語誤用がある THEN システムは二重敬語（「お伺いさせていただく」等）を検出する
5. WHEN テキストがスタイルガイドに逸脱 THEN システムは一文60字超・読点過不足を検出する
6. WHEN テキストにリスク表現がある THEN システムは断定的効果表現を注意表示（自動修正なし）する
7. WHERE ルール検出の精度 THE システムはF1スコア≥0.70を達成する

### 要件3: LLM提案機能
**ユーザーストーリー:** ユーザーとして、文脈を理解したLLM提案を利用したいので、ルールで捉えきれない読みやすさを改善できる

#### 受け入れ基準
1. WHEN ユーザーがLLM提案をONにする AND ルールで未検出の問題がある THEN システムは文脈的な改善案を提案する
2. WHEN LLM提案を生成 THEN システムは最大3案の修正文と80字以内の理由を提供する
3. WHEN LLM提案を送信 THEN システムは対象文±前後1文のみを抜粋送信する
4. WHEN LLM提案の応答時間 THEN システムは1.5-3.0秒を目安とし10秒でタイムアウトする
5. IF LLMがタイムアウト THEN システムはLLM提案のみエラー表示し、ルール結果は維持する

### 要件4: 結果表示・修正適用機能
**ユーザーストーリー:** ユーザーとして、検出結果を視覚的に確認し修正を適用したいので、効率的に文章を改善できる

#### 受け入れ基準
1. WHEN 解析が完了 THEN システムは本文内にハイライト（下線）とサイドのIssueリストを表示する
2. WHEN ユーザーがIssueを選択 THEN システムは内容・理由・修正案を右パネルに表示する
3. WHEN ユーザーが「適用」ボタンをクリック THEN システムはその箇所のみ即座に反映する
4. WHEN ユーザーが「Fix All（安全）」をクリック THEN システムは安全置換が定義されたIssueのみ一括反映する
5. WHERE 修正提案の採用率 THE システムは≥60%を達成する

### 要件5: ルール管理機能
**ユーザーストーリー:** ユーザーとして、ルールセットをカスタマイズしたいので、組織や個人の表記ポリシーに合わせられる

#### 受け入れ基準
1. WHEN ユーザーが設定画面を開く THEN システムはルールセットの切替・ON/OFF・重大度変更の選択肢を提供する
2. WHEN ユーザーがルールセットを変更 THEN システムは画面リロード不要で即座に適用する
3. WHEN ルールセットを読み込み失敗 THEN システムは既定ルールにフォールバックし設定画面に警告を表示する
4. WHERE ルールの再読込 THE システムは1秒未満で応答する

### 要件6: 設定・セキュリティ機能
**ユーザーストーリー:** ユーザーとして、プライバシーを保護しつつ設定をカスタマイズしたいので、安全に利用できる

#### 受け入れ基準
1. WHEN ユーザーが文章を入力 THEN システムはローカルメモリ上のみで処理し永続化しない
2. WHEN LLM提案を利用 THEN システムはユーザー明示的許可時のみ抜粋最小限で送信する
3. WHEN APIキーを管理 THEN システムは安全な環境変数管理でUI非表示とする
4. WHEN 設定を変更 THEN システムは解析モード・一文制限値・LLM提案ON/OFF・Gemini接続情報を保持する
5. WHERE すべての操作 THE システムはキーボードのみで完了可能とする